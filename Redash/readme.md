# Запросы для Redash
В данном разделе указаны запросы, оптимизированные для работы на платформе Redash (https://redash.io/). В запросах встречаются конструкции типа `{{ date1 }}` - это указание параметров, которые используются в графическом интерфейсе.
При выполнении запроса эти параметры заменяются на строковые выражения, поэтому обычно они обрамляются в кавычки. Исключением служат конструкции `... WHERE id IN ({{items}})...`: в таком случае параметры выбираются как "несколько из списка" и каждый отдельно заключен в кавычках
# Типовые решения для запросов в Redash
Редаш - это достаточно мощный инструмент для предоставления аналитики конечному пользователю, при этом - не требующий специальных знаний. Но, не смотря на это для разработки отчётов часто приходится применять нестандартные решения
## Указать необязательный параметр ##
Редаш как бы говорит: нельзя так просто взять и не использовать параметр, сделав запрос более универсальным. Однако, был выявлен следующий вариант как обойти это ограничение:
```sql
WHERE ('{{ Id_user }}'='-'
       OR bh.id_user = '{{ Id_user }}')
```
В таком случае, если мы используем в качестве параметра '-' это условие не будет выполняться, так как в логическом выражении `ИЛИ` при первом результате `true` остальные результаты не смотрятся и всё выражение принимает значение `true`
## Оптимизация, путём предварительной оценки условий ##
Иногда для лучшей производительности универсального запроса нужно проверить на выполнение определённых условий. В базах на MySQL я это делаю следующим образом:
```sql
SET @is_all_usr = (if("Все сотрудники" IN ({{ usr }}),TRUE, FALSE));
```
Переменная `@is_all_usr` будет принимать логическое значение `TRUE` или `FALSE`. На основе этого можно отказаться от выполнения тех или иных частей запроса с помощью `IF`:
```sql
if(@is_all_usr,'Все сотрудники',                                   
     /*подзапрос для выбора вывода сотрудника*/) AS `Сотрудник`
```
Также эту переменную можно использовать для применения фильтра:
```sql
HAVING if(!@is_all_usr,`Сотрудник` IN ({{ usr }}),TRUE)
--если @is_all_usr=TRUE то выражение будет тождественно HAVING TRUE и оператор не будет выполнен
```
